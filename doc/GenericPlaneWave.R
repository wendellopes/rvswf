#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# ONDA PLANA
#-------------------------------------------------------------------------------
# Campo Eletrico \vec{k}=k\hat{k}_z
# E=Eo exp(ik_zz)
#-------------------------------------------------------------------------------
# FUNCOES
#-------------------------------------------------------------------------------
source("BSC.R")
source("HansenMultipoles.R")
#-------------------------------------------------------------------------------
# PARÂMETROS
#-------------------------------------------------------------------------------
lambda=.5e-6
ko=2*pi/lambda
lmax<-40
#-------------------------------------------------------------------------------
n.lambda=1
NP=200
z<-seq(-n.lambda*lambda,n.lambda*lambda,by=2*n.lambda*lambda/(NP-1))
#-------------------------------------------------------------------------------
xo<-sample(z,1)  # Entre 1:NP
yo<-sample(z,1)  # Entre 1:NP
zo<-sample(z,1)  # Entre 1:NP
#-------------------------------------------------------------------------------
# Calcula os campos - u e k devem ser ortogonais
#-------------------------------------------------------------------------------
ux<-sample(-10:10,1)
uy<-0
uz<-sample(-10:10,1)
#-------------------------------------------------------------------------------
kx<-0
ky<-sample(-10:10,1)
kz<-0
#-------------------------------------------------------------------------------
# CALCULO DOS MODULOS
#-------------------------------------------------------------------------------
u<-sqrt(Conj(ux)*ux+Conj(uy)*uy+Conj(uz)*uz)
k<-sqrt(Conj(kx)*kx+Conj(ky)*ky+Conj(kz)*kz)
#-------------------------------------------------------------------------------
# NORMALIZACAO DE u
#-------------------------------------------------------------------------------
ux<-ux/u
uy<-uy/u
uz<-uz/u
um<-(ux-1i*uy)/sqrt(2)
up<-(ux+1i*uy)/sqrt(2)
#-------------------------------------------------------------------------------
# NORMALIZACAO DE k
#-------------------------------------------------------------------------------
kx<-kx/k
ky<-ky/k
kz<-kz/k
km<-(kx-1i*ky)/sqrt(2)
kp<-(kx+1i*ky)/sqrt(2)
#-------------------------------------------------------------------------------
# CAMPO ELETRICO
#-------------------------------------------------------------------------------
E0<-exp(1i*ko*(kx*xo+ky*yo+kz*zo))
#-------------------------------------------------------------------------------
Em<-E0*um
Ez<-E0*uz
Ep<-E0*up
#-------------------------------------------------------------------------------
# CAMPO MAGNETICO
#-------------------------------------------------------------------------------
Hm<-1i*E0*(km*uz-kz*um)
Hz<-1i*E0*(kp*um-km*up)
Hp<-1i*E0*(kz*up-kp*uz)
#-------------------------------------------------------------------------------
# Calcula os BSC
# VSH&HM
#-------------------------------------------------------------------------------
v<-HansenMultipoles(ko,xo,yo,zo,lmax)
#-------------------------------------------------------------------------------
# PLANE WAVE
#-------------------------------------------------------------------------------
#PlaneWave(kx,ky,kz,ux,uy,uz,lmax)
G<-PlaneWave(ko*kx,ko*ky,ko*kz,ux,uy,uz,lmax)
#-------------------------------------------------------------------------------
Em.pwe<-sum(G$GTE*v$M.m-G$GTM*v$N.m)
Ez.pwe<-sum(G$GTE*v$M.z-G$GTM*v$N.z)
Ep.pwe<-sum(G$GTE*v$M.p-G$GTM*v$N.p)

Hm.pwe<-sum(G$GTM*v$M.m+G$GTE*v$N.m)
Hz.pwe<-sum(G$GTM*v$M.z+G$GTE*v$N.z)
Hp.pwe<-sum(G$GTM*v$M.p+G$GTE*v$N.p)
#-------------------------------------------------------------------------------
Em.pwe0<-sum(G$GTE0*v$M.m-G$GTM0*v$N.m)
Ez.pwe0<-sum(G$GTE0*v$M.z-G$GTM0*v$N.z)
Ep.pwe0<-sum(G$GTE0*v$M.p-G$GTM0*v$N.p)
                                
Hm.pwe0<-sum(G$GTM0*v$M.m+G$GTE0*v$N.m)
Hz.pwe0<-sum(G$GTM0*v$M.z+G$GTE0*v$N.z)
Hp.pwe0<-sum(G$GTM0*v$M.p+G$GTE0*v$N.p)
#-------------------------------------------------------------------------------
# CONFERINDO
#-------------------------------------------------------------------------------
H<-c(Hm,Hz,Hp)
E<-c(Em,Ez,Ep)
print(cbind(E,H))
#-------------------------------------------------------------------------------
E.pwe<-c(Em.pwe,Ez.pwe,Ep.pwe)
H.pwe<-c(Hm.pwe,Hz.pwe,Hp.pwe)
print(cbind(E.pwe,H.pwe))
#-------------------------------------------------------------------------------
E.pwe0<-c(Em.pwe0,Ez.pwe0,Ep.pwe0)
H.pwe0<-c(Hm.pwe0,Hz.pwe0,Hp.pwe0)
print(cbind(E.pwe0,H.pwe0))
#-------------------------------------------------------------------------------
